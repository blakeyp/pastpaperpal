{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}

<div class="row">

	<div class="col-md-4"></div>

	<div class="col-md-4" style="font-size:18px; margin-top: 100px;">
		<div class="form-group has-feedback">
			<input style="font-size:20pt; margin-top:15px;" id="module_search" type="text" class="form-control input-lg" autofocus placeholder="Search a module code...">
			<i class="glyphicon glyphicon-search form-control-feedback"></i>
		</div>
		<div id="results" style="padding:10px; line-height:22pt;"></div>
	</div>

	<div class="col-md-4"></div>

</div>

<script>

	// populate list of modules from server (on page load)
	var modules = {{module_codes|safe}};

	// regex to validate module code input
	var valid_code = new RegExp("^[A-Z]{1,2}[0-9]{0,3}$");

	// validate input on key up of module code search box
	// call to update results
	$('#module_search').keyup(function() {
			$("#results").html("");   // clear current results
	    var input = this.value.toUpperCase();
	    if (input.length == 0) return;
	    if (!valid_code.test(input)) {
	    		$("#results").html("Oops. This doesn't look much \
	    			like a valid module code..."); return; }
	    var found_results = updateResults(input);
	   	if (input.length == 5 && !found_results)
	    	$("#results").html("Oops. No paper has been uploaded \
	    		yet for this module. Upload one?");
	});

	// updates module search results using list of module codes
	function updateResults(input) {
		var found_results = false;
    for (i=0; i<modules.length; i++) {
      if (modules[i].startsWith(input)) {
      	// concatenate to existing results
				$("#results").html($("#results").html() + modules[i]+'</br>');
				found_results = true;
			}
    }
    return found_results;
	}

	/* // some random ajax examples:

	$.ajax({
	  dataType: "json",
	  url: "get_modules",
	  data: input_text,   // to pass to server
	  success: function(result){   // on getting result from server
			modules = result["modules"];
		});
	});

	// or, equivalently:

	$.getJSON('get_modules', input_text, function(result){
		modules = result["modules"];
	});

	*/

</script>

{% endblock %}